services:
  web:
    build:
      context: .
      args:
        - NEXT_PUBLIC_SITE_URL=${NEXT_PUBLIC_SITE_URL}
        - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
        - NEXT_PUBLIC_SUPABASE_ANON_KEY=${NEXT_PUBLIC_SUPABASE_ANON_KEY}
        - ADMIN_EMAILS=${ADMIN_EMAILS}
    command: ["node", "server.js"]
    environment:
      NODE_ENV: production
      NEXT_TELEMETRY_DISABLED: 1
      NEXT_PUBLIC_SITE_URL: ${NEXT_PUBLIC_SITE_URL}
      NEXT_PUBLIC_SUPABASE_URL: ${NEXT_PUBLIC_SUPABASE_URL}
      NEXT_PUBLIC_SUPABASE_ANON_KEY: ${NEXT_PUBLIC_SUPABASE_ANON_KEY}
      ADMIN_EMAILS: ${ADMIN_EMAILS}
    ports:
      - "3000:3000"
    restart: unless-stopped
    labels:
      - traefik.enable=true
      - traefik.http.routers.website.entrypoints=web,websecure
      - traefik.http.services.website.loadbalancer.server.port=3000
      - traefik.http.routers.website.rule=Host(`silasbeckmann.de`)
      - traefik.http.routers.website.tls=true
      - traefik.docker.network=traefik_proxy-net
      - traefik.http.middlewares.website.headers.SSLRedirect=true
      - traefik.http.middlewares.website.headers.STSSeconds=315360000
      - traefik.http.middlewares.website.headers.browserXSSFilter=true
      - traefik.http.middlewares.website.headers.contentTypeNosniff=true
      - traefik.http.middlewares.website.headers.forceSTSHeader=true
      - traefik.http.middlewares.website.headers.SSLHost=${DOMAIN_NAME:-silasbeckmann.de}
      - traefik.http.middlewares.website.headers.STSIncludeSubdomains=true
      - traefik.http.middlewares.website.headers.STSPreload=true
      - traefik.http.routers.website.middlewares=website@docker
    networks:
      - traefik_proxy-net

networks:
  traefik_proxy-net:
    external: true
